{% extends "base.html" %}

{% block extrahead %}
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/admin_shells.css" />
    <script src="{{ STATIC_URL}}js/jquery/jquery.tablednd_0_5.js" type="text/javascript"></script>
{% endblock %}


{% block content %}



<div id="content" class="grid_8">


{# Main shell attributes #}

<h2>Editing Shell "{{shell}}"</h2>

<p class="intro">
    A shell is a collection of pages.<br />
    You can arrange your pages in any order.

{% if shell.page_set.all.count < 1 %}
    <br />You must create at least one page before you can view your project.
{% endif %}
</p>


<ul class="nobullets">
    <li><a class="revealer" id="reveal" href="#">&raquo; Edit shell attributes (title, banner, colors)</a></li>


    <li><a id="" href="{% url shells_admin_new_page shell.id %}">&raquo; Add new page</a></li>

{% if shell.page_set.all.count > 0 %}
    <li><a id="" href="{% url shell_home shell.slug %}" target="_blank">&raquo; Launch shell in new tab</a></li>
{% endif %}
</ul>

<form class="pageform" id="shell_attribs" enctype="multipart/form-data" action="" method="post" accept-charset="utf-8">
	{% csrf_token %}

    <p>
        <label>{{shellform.title.label}}</label>
        <span class="help_text">{{shellform.title.help_text|safe}}</span>
        {{shellform.title}}
    </p>

    <p>
        <label>{{shellform.description.label}}</label>
        <span class="help_text">{{shellform.description.help_text|safe}}</span>
        {{shellform.description}}<br />
    </p>

    <p>
        <label>{{shellform.icon.label}}</label>
        <span class="help_text">{{shellform.icon.help_text|safe}} </span><br />
        {{shellform.icon}}<br />

         {% if shell.icon %}
            <a href="{{MEDIA_URL}}{{shell.icon}}"><img src="{{MEDIA_URL}}{{shell.icon}}" width="75" height="75" /></a>
            {% else %}
            <img src="{{STATIC_URL}}img/question.png" width="75" height="75">
        {% endif %}
    </p>


    <p>
        <label>{{shellform.bannerimg.label}}</label>
        <span class="help_text">{{shellform.bannerimg.help_text|safe}} </span><br />
        {{shellform.bannerimg}}<br />

         {% if shell.bannerimg %}
            <a href="{{MEDIA_URL}}{{shell.bannerimg}}"><img src="{{MEDIA_URL}}{{shell.bannerimg}}" width="500" /></a>
            {% else %}
            <img src="{{STATIC_URL}}img/question.png" width="75" height="75">
        {% endif %}
    </p>

    <p>
        <label>{{shellform.palette.label}}</label>
        {{shellform.palette}}<br />
        <span class="help_text">{{shellform.palette.help_text|safe}}</span>
    </p>

    <input class="button blue" type="submit" value="Save" style="margin-top:10px;" />
</form>

{# End main shell attributes #}

<h3>
	{% if shell.page_set.all.count > 0 %}
		Pages in this shell (drag arrows to re-order):
	{% else %}
		To begin, edit shell attributes, then click Add New Page.
	{% endif %}
</h3>

<table id="pagetable">
    {% for p in pages  %}
    <tr id="{{ p.id }}" class="{% cycle 'even' 'odd' %}" >
        <td class="dragHandle showDragHandle">&nbsp;</td>
        <td>
            <p>
                <a href="{% url shells_admin_page p.id %}">
                {{p.title}}</a>
            </p>
        </td>

    </tr>
    {% endfor %}
</table>


</div>


<script type="text/javascript" charset="utf-8">

function order_pages(data) {
    // The JQuery plugin tableDnD provides a serialize() function which provides the re-ordered
    // data in a list. We pass that list as an object called "data" to a Django view
    // to save the re-ordered data into the database.

    $.post("{% url shells_reorder_pages %}", data, "json");
    return False;
};

$(document).ready(function(){

    // Initially hide all main forms
    $('form.pageform').hide();

    // Show/hide edit fields
    $("a#reveal").click(function () {
      $("form#shell_attribs").slideToggle();
    });

    // Initialise the task table for drag/drop re-ordering
    $("#pagetable").tableDnD();

    $('#pagetable').tableDnD({
        onDrop: function(table, row) {
            order_pages($.tableDnD.serialize());
        },
        dragHandle: "dragHandle"
    });




});
</script>

{% endblock %}

